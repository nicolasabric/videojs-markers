/*! videojs-markers - v1.0.0 - 2018-01-25
* Copyright (c) 2018 ; Licensed  */

!function(e,r){if("function"==typeof define&&define.amd)define(["video.js"],r);else if("undefined"!=typeof exports)r(require("video.js"));else{r(e.videojs),e.videojsMarkers={}}}(this,function(e){"use strict";var r,t=(r=e)&&r.__esModule?r:{default:r};var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a={markerStyle:{width:"7px","border-radius":"30%","background-color":"red"},markerTip:{display:!0,text:function(e){return"Break: "+e.text},time:function(e){return e.time}},breakOverlay:{display:!1,displayTime:3,text:function(e){return"Break overlay: "+e.overlayText},style:{width:"100%",height:"20%","background-color":"rgba(0,0,0,0.7)",color:"white","font-size":"17px"}},onMarkerClick:function(e){},onMarkerReached:function(e,r){},markers:[]};function n(e){var r,t={top:0,bottom:0,left:0,width:0,height:0,right:0};try{r=e.getBoundingClientRect()}catch(e){r=t}return r}var o=-1;t.default.plugin("markers",function(e){if(!t.default.mergeOptions){var r=function(e){return!!e&&"object"===(void 0===e?"undefined":i(e))&&"[object Object]"===toString.call(e)&&e.constructor===Object};t.default.mergeOptions=function e(t,i){var a={};return[t,i].forEach(function(t){t&&Object.keys(t).forEach(function(i){var n=t[i];r(n)?(r(a[i])||(a[i]={}),a[i]=e(a[i],n)):a[i]=n})}),a}}t.default.createEl||(t.default.createEl=function(e,r,i){var a=t.default.Player.prototype.createEl(e,r);return i&&Object.keys(i).forEach(function(e){a.setAttribute(e,i[e])}),a});var l=t.default.mergeOptions(a,e),s={},u=[],d=o,c=this,f=null,m=null,v=o;function y(){u.sort(function(e,r){return l.markerTip.time(e)-l.markerTip.time(r)})}function k(e){e.forEach(function(e){var r,i,a,o;e.key=(r=(new Date).getTime(),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=(r+16*Math.random())%16|0;return r=Math.floor(r/16),("x"==e?t:3&t|8).toString(16)})),c.el().querySelector(".vjs-progress-holder").appendChild((i=e,o=t.default.createEl("div",{},{"data-marker-key":i.key,"data-marker-time":l.markerTip.time(i)}),h(i,o),o.addEventListener("click",function(e){var r=!1;if("function"==typeof l.onMarkerClick&&(r=!1===l.onMarkerClick(i)),!r){var t=this.getAttribute("data-marker-key");c.currentTime(l.markerTip.time(s[t]))}}),l.markerTip.display&&((a=o).addEventListener("mouseover",function(){var e=s[a.getAttribute("data-marker-key")];if(f){f.querySelector(".vjs-tip-inner").innerText=l.markerTip.text(e),f.style.left=p(e)+"%";var r=n(f),t=n(a),i=n(c.el()),o=t.x+t.width/2,u=parseFloat(r.width/2),d=parseFloat(t.width/4),m=0;f.className="vjs-tip aligned-right",o-u>i.x&&(f.className="vjs-tip",m=-parseFloat(r.width/2)+d),o+u>i.x+i.width&&(f.className="vjs-tip aligned-left",m=-r.width+parseFloat(t.width/2)),f.style.marginLeft=m+"px",f.style.visibility="visible"}}),a.addEventListener("mouseout",function(){f&&(f.style.visibility="hidden")})),o)),s[e.key]=e,u.push(e)}),y()}function p(e){return l.markerTip.time(e)/c.duration()*100}function h(e,r){r.className="vjs-marker "+(e.class||""),Object.keys(l.markerStyle).forEach(function(e){r.style[e]=l.markerStyle[e]});var t=e.time/c.duration();if((t<0||t>1)&&(r.style.display="none"),r.style.left=p(e)+"%",e.duration)r.style.width=e.duration/c.duration()*100+"%",r.style.marginLeft="0px";else{var i=n(r);r.style.marginLeft=i.width/2+"px"}}function x(e){m&&(v=o,m.style.visibility="hidden"),d=o;var r=[];e.forEach(function(e){var t=u[e];if(t){delete s[t.key],r.push(e);var i=c.el().querySelector(".vjs-marker[data-marker-key='"+t.key+"']");i&&i.parentNode.removeChild(i)}}),r.reverse(),r.forEach(function(e){u.splice(e,1)}),y()}function b(){if(l.breakOverlay.display&&!(d<0)){var e=c.currentTime(),r=u[d],t=l.markerTip.time(r);e>=t&&e<=t+l.breakOverlay.displayTime?(v!==d&&(v=d,m&&(m.querySelector(".vjs-break-overlay-text").innerHTML=l.breakOverlay.text(r))),m&&(m.style.visibility="visible")):(v=o,m&&(m.style.visibility="hidden"))}}function g(){!function(){if(u.length){var r=function(e){return e<u.length-1?l.markerTip.time(u[e+1]):c.duration()},t=c.currentTime(),i=o;if(d!==o){var a=r(d);if(t>=l.markerTip.time(u[d])&&t<a)return;if(d===u.length-1&&t===c.duration())return}if(t<l.markerTip.time(u[0]))i=o;else for(var n=0;n<u.length;n++)if(a=r(n),t>=l.markerTip.time(u[n])&&t<a){i=n;break}i!==d&&(i!==o&&e.onMarkerReached&&e.onMarkerReached(u[i],i),d=i)}}(),b(),e.onTimeUpdateAfterMarkerUpdate&&e.onTimeUpdateAfterMarkerUpdate()}function T(){l.markerTip.display&&(f=t.default.createEl("div",{className:"vjs-tip",innerHTML:"<div class='vjs-tip-arrow'></div><div class='vjs-tip-inner'></div>"}),c.el().querySelector(".vjs-progress-holder").appendChild(f)),c.markers.removeAll(),k(l.markers),l.breakOverlay.display&&(m=t.default.createEl("div",{className:"vjs-break-overlay",innerHTML:"<div class='vjs-break-overlay-text'></div>"}),Object.keys(l.breakOverlay.style).forEach(function(e){m&&(m.style[e]=l.breakOverlay.style[e])}),c.el().appendChild(m),v=o),g(),c.on("timeupdate",g),c.off("loadedmetadata")}c.on("loadedmetadata",function(){T()}),c.markers={getMarkers:function(){return u},next:function(){for(var e=c.currentTime(),r=0;r<u.length;r++){var t=l.markerTip.time(u[r]);if(t>e){c.currentTime(t);break}}},prev:function(){for(var e=c.currentTime(),r=u.length-1;r>=0;r--){var t=l.markerTip.time(u[r]);if(t+.5<e)return void c.currentTime(t)}},add:function(e){k(e)},remove:function(e){x(e)},removeAll:function(){for(var e=[],r=0;r<u.length;r++)e.push(r);x(e)},updateTime:function(e){var r;r=e,u.forEach(function(e){var t=c.el().querySelector(".vjs-marker[data-marker-key='"+e.key+"']"),i=l.markerTip.time(e);(r||t.getAttribute("data-marker-time")!==i)&&(h(e,t),t.setAttribute("data-marker-time",i))}),y()},reset:function(e){c.markers.removeAll(),k(e)},destroy:function(){c.markers.removeAll(),m&&m.remove(),f&&f.remove(),c.off("timeupdate",b),delete c.markers}}})});